/*
 * ExperimentRunner.c
 *
 *  Created on: Mar 24, 2022
 *      Author: kanherea
 */

#include "common.h"

#include "ThreadSafeWrapper_Mutex.h"
#include "ThreadSafeWrapper_Queue.h"

#define USER_TASKS    2
#define USER_TASK_STACK_DEPTH    100

void vUserTask( void * args );

void RunExperiment( void )
{
	BaseType_t xInitSuccess;
	char pucTaskName[15];
	xTaskArgType_t xArgs;
	TaskHandle_t xUserTaskHandle[ USER_TASKS ];
	UBaseType_t uxPriority;

#if( testUSE_QUEUE == 1 )
	xInitSuccess = ThreadSafeWrapper_QueueInit();
#else
	xInitSuccess = ThreadSafeWrapper_MutexInit();
#endif

	if( xInitSuccess == pdTRUE )
	{
		for( int i = 0; i < USER_TASKS; i++ )
		{
			snprintf( pucTaskName, "UserTask%d", i );

			xArgs.uxUseBusyWait = testUSE_BUSY_WAIT;
			xArgs.xUseRandomValues = testUSE_RANDOM_DELAYS;
			xArgs.uxValueToSend = testMAX_SEND_DELAY;

			uxPriority = 1;

			xTaskCreate( vUserTask,
						 pucTaskName,
						 USER_TASK_STACK_DEPTH,
						 &xArgs,
						 uxPriority,
						 &xUserTaskHandle[ i ] );
		}
	}
}

void vUserTask( void * args )
{
    ( void ) args;
}
